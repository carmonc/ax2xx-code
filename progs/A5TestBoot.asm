.equ	RESET,	0
.equ	RAM_20, 0x20
.equ	RAM_21, 0x21
.equ	RAM_22, 0x22
.equ	RAM_23, 0x23
.equ    RAM_24, 0x24
.equ	SDSM,	0x90
.equ	ER20,	0xD8
.equ	ER21,	0xD9
.equ	ER22,	0xDA
.equ	ER23,	0xDB
.equ	ER30,	0xF8
.equ	ER31,	0xF9
.equ	ER32,	0xFA
.equ	ER33,	0xFB
.equ    FSR_80, 0x80
.equ    FSR_81, 0x81
.equ    FSR_82, 0x82
.equ    FSR_83, 0x83
.equ    FSR_84, 0x84
.equ    FSR_85, 0x85
.equ    FSR_86, 0x86
.equ    FSR_87, 0x87
.equ    FSR_88, 0x88
.equ    FSR_89, 0x89
.equ    FSR_8A, 0x8A
.equ    FSR_8B, 0x8B
.equ    FSR_8C, 0x8C
.equ    FSR_8D, 0x8D
.equ    FSR_8E, 0x8E
.equ    FSR_8F, 0x8F
.equ    FSR_90, 0x90
.equ    FSR_91, 0x91
.equ    FSR_92, 0x92
.equ    FSR_93, 0x93
.equ    FSR_94, 0x94
.equ    FSR_95, 0x95
.equ    FSR_96, 0x96
.equ    FSR_97, 0x97
.equ    FSR_98, 0x98
.equ    FSR_99, 0x99
.equ    FSR_9A, 0x9A
.equ    FSR_9B, 0x9B
.equ    FSR_9C, 0x9C
.equ    FSR_9D, 0x9D
.equ    FSR_9E, 0x9E
.equ    FSR_9F, 0x9F
.equ    FSR_A0, 0xA0
.equ    FSR_A1, 0xA1
.equ    FSR_A2, 0xA2
.equ    FSR_A3, 0xA3
.equ    FSR_A4, 0xA4
.equ    FSR_A5, 0xA5
.equ    FSR_A6, 0xA6
.equ    FSR_A7, 0xA7
.equ    FSR_A8, 0xA8
.equ    FSR_A9, 0xA9
.equ    FSR_AA, 0xAA
.equ    FSR_AB, 0xAB
.equ    FSR_AC, 0xAC
.equ    FSR_AD, 0xAD
.equ    FSR_AE, 0xAE
.equ    FSR_AF, 0xAF
.equ    FSR_B0, 0xB0
.equ    FSR_B1, 0xB1
.equ    FSR_B2, 0xB2
.equ    FSR_B3, 0xB3
.equ    FSR_B4, 0xB4
.equ    FSR_B5, 0xB5
.equ    FSR_B6, 0xB6
.equ    FSR_B7, 0xB7
.equ    FSR_B8, 0xB8
.equ    FSR_B9, 0xB9
.equ    FSR_BA, 0xBA
.equ    FSR_BB, 0xBB
.equ    FSR_BC, 0xBC
.equ    FSR_BD, 0xBD
.equ    FSR_BE, 0xBE
.equ    FSR_BF, 0xBF
.equ    FSR_C0, 0xC0
.equ    FSR_C1, 0xC1
.equ    FSR_C2, 0xC2
.equ    FSR_C3, 0xC3
.equ    FSR_C4, 0xC4
.equ    FSR_C5, 0xC5
.equ    FSR_C6, 0xC6
.equ    FSR_C7, 0xC7
.equ    FSR_C8, 0xC8
.equ    FSR_C9, 0xC9
.equ    FSR_CA, 0xCA
.equ    FSR_CB, 0xCB
.equ    FSR_CC, 0xCC
.equ    FSR_CD, 0xCD
.equ    FSR_CE, 0xCE
.equ    FSR_CF, 0xCF
.equ    FSR_D0, 0xD0
.equ    FSR_D1, 0xD1
.equ    FSR_D2, 0xD2
.equ    FSR_D3, 0xD3
.equ    FSR_D4, 0xD4
.equ    FSR_D5, 0xD5
.equ    FSR_D6, 0xD6
.equ    FSR_D7, 0xD7
.equ    FSR_D8, 0xD8
.equ    FSR_D9, 0xD9
.equ    FSR_DA, 0xDA
.equ    FSR_DB, 0xDB
.equ    FSR_DC, 0xDC
.equ    FSR_DD, 0xDD
.equ    FSR_DE, 0xDE
.equ    FSR_DF, 0xDF
.equ    FSR_E0, 0xE0
.equ    FSR_E1, 0xE1
.equ    FSR_E2, 0xE2
.equ    FSR_E3, 0xE3
.equ    FSR_E4, 0xE4
.equ    FSR_E5, 0xE5
.equ    FSR_E6, 0xE6
.equ    FSR_E7, 0xE7
.equ    FSR_E8, 0xE8
.equ    FSR_E9, 0xE9
.equ    FSR_EA, 0xEA
.equ    FSR_EB, 0xEB
.equ    FSR_EC, 0xEC
.equ    FSR_ED, 0xED
.equ    FSR_EE, 0xEE
.equ    FSR_EF, 0xEF
.equ    FSR_F0, 0xF0
.equ    FSR_F1, 0xF1
.equ    FSR_F2, 0xF2
.equ    FSR_F3, 0xF3
.equ    FSR_F4, 0xF4
.equ    FSR_F5, 0xF5
.equ    FSR_F6, 0xF6
.equ    FSR_F7, 0xF7
.equ    FSR_F8, 0xF8
.equ    FSR_F9, 0xF9
.equ    FSR_FA, 0xFA
.equ    FSR_FB, 0xFB
.equ    FSR_FC, 0xFC
.equ    FSR_FD, 0xFD
.equ    FSR_FE, 0xFE
.equ    FSR_FF, 0xFF

entry:
                ljmp    relocate_pc

; =============== S U B R O U T I N E =======================================


maybe_set_spi_pins:                     ; CODE XREF: ROM:7B23p
                clr     FSR_A0.2
                anl     FSR_E8, #0xF0
                orl     FSR_DC, #4
                orl     FSR_DC, #8
                ret
; End of function maybe_set_spi_pins

; ---------------------------------------------------------------------------

relocate_pc:                            ; CODE XREF: ROM:entryj
                anl     FSR_DC, #0xFE
                mov     A, #0x1B
                push    ACC             ; Accumulator
                mov     A, #0x7B ; '{'
                push    ACC             ; Accumulator
                reti
; ---------------------------------------------------------------------------

non_irq_entry:                          ; Disable interrupts
                mov     IE, #0
                mov     SP, #FSR_80     ; Reset stack pointer
                setb    RAM_24.0
                acall   maybe_set_spi_pins

wait_for_spi_ready:                     ; CODE XREF: ROM:7B29j
                                        ; ROM:7B5Aj ...
                mov     R5, #0
                mov     A, FSR_E8
                jnb     ACC.0, wait_for_spi_ready ; Accumulator
                anl     FSR_E8, #0xFE

ROM_7B2F:                               ; CODE XREF: ROM:ROM_7B2Fj
                jnb     SDSM.4, ROM_7B2F ; SD state machine
                mov     A, FSR_E6       ; SD Incoming Command
                jz      ROM_7B56
                mov     A, FSR_E6       ; SD Incoming Command
                xrl     A, #0x14
                jz      ROM_7BB2
                mov     A, FSR_E6       ; SD Incoming Command
                xrl     A, #0x32
                jz      ROM_7B5C
                mov     A, FSR_E6       ; SD Incoming Command
                xrl     A, #0x33
                jz      ROM_7B60
                mov     A, FSR_E6       ; SD Incoming Command
                xrl     A, #9
                jz      ROM_7B64
                mov     A, FSR_E6       ; SD Incoming Command
                xrl     A, #0x35
                jz      ROM_7B68
                ajmp    ROM_7C85
; ---------------------------------------------------------------------------

ROM_7B56:                               ; CODE XREF: ROM:7B34j
                clr     RAM_24.0
                acall   xmit_something
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7B5C:                               ; CODE XREF: ROM:7B40j
                acall   ROM_7CA1
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7B60:                               ; CODE XREF: ROM:7B46j
                acall   ROM_7CC6
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7B64:                               ; CODE XREF: ROM:7B4Cj
                acall   ROM_7C32
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7B68:                               ; CODE XREF: ROM:7B52j
                anl     FSR_E8, #0xFD
                mov     RAM_20, #0
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                jb      RAM_24.0, ROM_7B82
                mov     FSR_DE, #0
                mov     FSR_DF, #0
                mov     FSR_E7, #0xF1 ; 'Â±' ; SD output state
                sjmp    ROM_7B8E
; ---------------------------------------------------------------------------

ROM_7B82:                               ; CODE XREF: ROM:7B74j
                mov     RAM_23, #0
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state

ROM_7B8E:                               ; CODE XREF: ROM:7B80j
                                        ; ROM:7B90j
                mov     A, FSR_E8
                jnb     ACC.1, ROM_7B8E  ; Accumulator
                anl     FSR_E8, #0xFD
                mov     SP, #FSR_80     ; Stack Pointer
                ljmp    RESET           ; Power-on program execution start

; =============== S U B R O U T I N E =======================================


xmit_something:                         ; CODE XREF: ROM:7B58p
                anl     FSR_E8, #0xFD
                mov     RAM_20, #0
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #0
                mov     FSR_DF, #0
                mov     FSR_E7, #0xF1 ; 'Â±' ; SD output state
                ret
; End of function xmit_something

; ---------------------------------------------------------------------------

ROM_7BB2:                               ; CODE XREF: ROM:7B3Aj
                jnb     SDSM.0, ROM_7BBA ; SD state machine
                orl     FSR_E3, #1
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7BBA:                               ; CODE XREF: ROM:ROM_7BB2j
                anl     FSR_E8, #0xFD
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state
                mov     R7, #0
                mov     R6, #0

ROM_7BD0:                               ; CODE XREF: ROM:7C02j
                                        ; ROM:7C08j
                anl     FSR_E8, #0xFB
                mov     FSR_D4, R7
                mov     FSR_D5, R6
                clr     C
                mov     A, R7
                add     A, #0x80 ; 'Ã'
                mov     R7, A
                mov     A, R6
                addc    A, #0
                mov     R6, A
                mov     FSR_E1, #0xFF
                mov     FSR_E2, #1
                orl     FSR_DC, #1

ROM_7BE9:                               ; CODE XREF: ROM:7BEBj
                mov     A, FSR_E8
                jnb     ACC.2, ROM_7BE9  ; Accumulator
                mov     A, FSR_DC
                anl     A, #0x20
                jnz     ROM_7C0A
                mov     A, FSR_DC
                anl     A, #0x10
                jnz     ROM_7C0A
                mov     A, FSR_DC
                jb      ACC.6, ROM_7C04  ; Accumulator
                orl     FSR_DC, #2
                ajmp    ROM_7BD0
; ---------------------------------------------------------------------------

ROM_7C04:                               ; CODE XREF: ROM:7BFCj
                inc     R5
                orl     FSR_DC, #2
                ajmp    ROM_7BD0
; ---------------------------------------------------------------------------

ROM_7C0A:                               ; CODE XREF: ROM:7BF2j
                                        ; ROM:7BF8j
                anl     FSR_E8, #0xF8

ROM_7C0D:                               ; CODE XREF: ROM:7C11j
                mov     A, FSR_E3
                anl     A, #0xC
                jnz     ROM_7C0D
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state

ROM_7C22:                               ; CODE XREF: ROM:7C24j
                mov     A, FSR_E8
                jnb     ACC.1, ROM_7C22  ; Accumulator
                anl     FSR_E8, #0xFD
                anl     FSR_DC, #0xFE
                orl     FSR_DC, #2
                ajmp    wait_for_spi_ready

; =============== S U B R O U T I N E =======================================


ROM_7C32:                               ; CODE XREF: ROM:ROM_7B64p
                .db 0xa5,  0x1d
                mov     ER30, FSR_E9    ; SD Incoming Argument byte 0
                mov     ER31, FSR_EA    ; SD Incoming Argument byte 1
                mov     FSR_B7, #2
                .db 0xa5,  0xdc
                .db 0xa5,  0x19
                mov     ER20, FSR_EB    ; Extended (32-bit) register 2, byte 0
                mov     ER21, FSR_EC    ; Extended (32-bit) register 2, byte 1
                .db 0xa5,  0x1b
                anl     FSR_E8, #0xFD
                mov     RAM_20, #0
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #0
                mov     FSR_DF, #0
                mov     FSR_E7, #0xF1 ; 'Â±' ; SD output state
                anl     FSR_E8, #0xFB
                orl     FSR_E5, #0x40
                mov     FSR_D4, ER30    ; Extended (32-bit) register 3, byte 0
                mov     FSR_D5, ER31    ; Extended (32-bit) register 3, byte 1
                mov     FSR_E1, ER20    ; Extended (32-bit) register 2, byte 0
                mov     FSR_E2, ER21    ; Extended (32-bit) register 2, byte 1
                orl     FSR_DC, #1

ROM_7C73:                               ; CODE XREF: ROM_7C32+43j
                mov     A, FSR_E8
                jnb     ACC.2, ROM_7C73  ; Accumulator
                anl     FSR_E8, #0xFB
                anl     FSR_DC, #0xFE
                anl     FSR_E5, #0xBF
                orl     FSR_DC, #2
                ret
; End of function ROM_7C32

; ---------------------------------------------------------------------------

ROM_7C85:                               ; CODE XREF: ROM:7B54j
                jb      SDSM.0, ROM_7C9C ; SD state machine
                anl     FSR_E8, #0xFD
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state
                ajmp    wait_for_spi_ready
; ---------------------------------------------------------------------------

ROM_7C9C:                               ; CODE XREF: ROM:ROM_7C85j
                orl     FSR_E3, #1
                ajmp    wait_for_spi_ready

; =============== S U B R O U T I N E =======================================


ROM_7CA1:                               ; CODE XREF: ROM:ROM_7B5Cp
                mov     A, FSR_EC       ; SD Incoming Argument byte 3
                anl     FSR_E8, #0xFD
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state
                acall   ROM_7CF0

ROM_7CB7:                               ; CODE XREF: ROM_7CA1+18j
                mov     A, FSR_E8
                jnb     ACC.1, ROM_7CB7  ; Accumulator
                anl     FSR_E8, #0xFD
                anl     FSR_E8, #0xFE
                orl     FSR_E3, #1
                ret
; End of function ROM_7CA1


; =============== S U B R O U T I N E =======================================


ROM_7CC6:                               ; CODE XREF: ROM:ROM_7B60p
                mov     FSR_B4, FSR_EC  ; SD Incoming Argument byte 3
                mov     FSR_A1, FSR_EB  ; SD Incoming Argument byte 2
                mov     FSR_B0, FSR_EA  ; SD Incoming Argument byte 1
                mov     FSR_B2, FSR_E9  ; SD Incoming Argument byte 0
                mov     FSR_B1, #0
                anl     FSR_E8, #0xFD
                mov     FSR_D6, #0xE8 ; 'F' ; SD Outgoing Address / 4 (low)
                mov     FSR_D7, #0x1F   ; SD Outgoing Address / 4 (high)
                mov     FSR_DE, #3
                mov     FSR_DF, #0
                mov     FSR_E7, #1      ; SD output state

ROM_7CE7:                               ; CODE XREF: ROM_7CC6+23j
                mov     A, FSR_E8
                jnb     ACC.1, ROM_7CE7  ; Accumulator
                anl     FSR_E8, #0xFD
                ret
; End of function ROM_7CC6


; =============== S U B R O U T I N E =======================================


ROM_7CF0:                               ; CODE XREF: ROM_7CA1+14p
                mov     FSR_B3, A
                setb    FSR_B0.3

ROM_7CF4:                               ; CODE XREF: ROM_7CF0:ROM_7CF4j
                jnb     FSR_B0.3, ROM_7CF4
                clr     FSR_B0.3
                ret
; End of function ROM_7CF0

; ---------------------------------------------------------------------------
                .byte 0xFF
                .byte 0xFF
                .byte 0xFF
                .byte    2
                .byte 0x15
                .byte    0
